<!doctype html>
<html>
  <head>
    <title>404 error page</title>
    <script type="text/javascript">
      window.isErrorPage = true;
      window.errorCode = '404';
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="404 error page" />
    <script
      src="/scripts/scripts.js"
      type="module"
      crossorigin="use-credentials"
    ></script>

    <script type="module">
      import { sampleRUM } from '/scripts/aem.js';
      import { getPathDetails } from '/scripts/scripts.js';
      import { loadFragment } from '/blocks/fragment/fragment.js';
      const defaultLangRegion = 'en-au';
      const { langRegion = defaultLangRegion } = getPathDetails() || {};
      const errorPagePath = `/${langRegion}/error-pages/404.plain.html`;
      const defaultErrorHTML = `
            <div class="default-content-wrapper">
                <h1>Looks like a 404 error</h1>
                <p>We're having trouble finding what you're looking for. Try checking the web address and refresh the page. If that doesn't work, head back to the&nbsp;<a href="/${defaultLangRegion}">homepage</a>.</p>
            </div>
          `;
      const fetchAndParseHTML = async (tagName) => {
        const container = document.querySelector('main .section');
        try {
          let fragment = await loadFragment(errorPagePath);
          if (fragment == null && defaultLangRegion !== langRegion) {
            fragment = await loadFragment(
              `/${defaultLangRegion}/error-pages/404.plain.html`,
            );
          }
          if (fragment) {
            const fragmentSection = fragment.querySelector(':scope .section');
            if (fragmentSection) {
              container.classList.add(...fragmentSection.classList);
              container.replaceWith(...fragment.childNodes);
            }
          } else {
            container.insertAdjacentHTML('afterbegin', defaultErrorHTML);
          }
        } catch (error) {
          // Default Error Message in case of any error
          container.insertAdjacentHTML('afterbegin', defaultErrorHTML);
        }
      };

      // Ensure fetchAndParseHTML is always called, even if the script loads after the window 'load' event.
      // If the document is already fully loaded, call directly. Otherwise, attach to the window 'load' event.
      if (document.readyState === 'complete') {
        // Script loaded after window 'load' event; call directly
        sampleRUM('404', { source: document.referrer });
        fetchAndParseHTML('main');
      } else {
        // Script loaded before window 'load' event; attach event listener
        window.addEventListener('load', () => {
          sampleRUM('404', { source: document.referrer });
          fetchAndParseHTML('main');
        });
      }
    </script>
    <link rel="stylesheet" href="/styles/styles.css" />
  </head>

  <body>
    <header></header>
    <main class="error">
      <div class="section text-center"></div>
    </main>
    <footer></footer>
  </body>
</html>
